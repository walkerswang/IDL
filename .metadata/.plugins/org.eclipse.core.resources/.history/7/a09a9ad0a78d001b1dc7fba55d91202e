ave_on2=MAKE_ARRAY(360, 180, 12, /float, VALUE = 0.0) ;long(0,360), theta(0,180)
cnt=MAKE_ARRAY(360, 180, 12, /interger, VALUE = 0)

filelist = file_search('/Users/wzihan/data/gold/on2/*.nc')
nFiles = n_elements(filelist)

for iFile = 0, nFiles-1 do begin
  
  READ_GOLD_NCDF, filelist[ifile], test_data
  print,filelist[ifile]
  nscan=size(test_data.dqi,dimension=1)
  nscan=nscan[0]
  st=test_data.scan_start_time
  nsize=size(test_data.latitude,dimension=1)
  lat=test_data.latitude
  lon=test_data.longitude
  ratio=test_data.on2
  time=test_data.scan_start_time
  dqi=test_data.on2_dqi

  for s=0,nscan-1 do begin
    for i=0, nsize[0]-1 do begin
      for j=0, nsize[1]-1 do begin
        if ~FINITE(lat[i,j], /NAN) and ~FINITE(lon[i,j], /NAN) and ~FINITE(ratio[i,j,s], /NAN) then begin
          if dqi[i,j,s] eq 0 then begin  
            month=fix(strmid(time[s],5,2))
            theta=floor(90-lat[i,j])
            if lon[i,j]<0 then begin
              lo=floor(lon[i,j]+360)
            endif else begin
              lo=floor(lon[i,j])
            endelse
            
            cnt[lo,theta,month]=cnt[lo,theta,month]+1
            ave_on2[lo,theta,month]=ave_on2[lo,theta,month]+ratio[i,j,s]
          endif  
        endif
      endfor
    endfor
  endfor
  
endfor

save, la, lo, on2, strdate, filename='/Users/wzihan/data/GOLD/on2_stat.sav'

end